
#E-commerce
create database if not exists ORDER_DIR;

use ORDER_DIR;


CREATE TABLE IF NOT EXISTS `SUPPLIER`(
`SUPPLIER_ID` INT PRIMARY KEY,
`SUPPLIER_NAME` VARCHAR(50) ,
`SUPPLIER_CITY` VARCHAR(50),
`SUPPLIER_PHONE` VARCHAR(10)	
);


CREATE TABLE IF NOT EXISTS `CUSTOMER` (
  `CUSTOMER_ID` INT NOT NULL,
  `CUSTOMER_NAME` VARCHAR(20) DEFAULT NULL,
  `CUSTOMER_PHONE` VARCHAR(10),
  `CUSTOMER_CITY` VARCHAR(30) ,
  `CUSTOMER_GENDER` CHAR,
  PRIMARY KEY (`CUSTOMER_ID`)
 );



CREATE TABLE IF NOT EXISTS `CATEGORY` (
  `CATEGORY_ID` INT NOT NULL,
  `CATEGORY_NAME` VARCHAR(20) DEFAULT NULL,
   PRIMARY KEY (`CATEGORY_ID`)
  );

 
 
CREATE TABLE IF NOT EXISTS `PRODUCT` (
  `PRODUCT_ID` INT NOT NULL,
  `PRODUCT_NAME` VARCHAR(20) DEFAULT NULL,
  `PRODUCT_DESC` VARCHAR(60) DEFAULT NULL,
  `CATEGORY_ID` INT NOT NULL,
  PRIMARY KEY (`PRODUCT_ID`),
  FOREIGN KEY (`CATEGORY_ID`) REFERENCES CATEGORY (`CATEGORY_ID`)  
  );

 
 
CREATE TABLE IF NOT EXISTS `PRODUCT_DETAILS` (
  `PRODUCT_DETAILS_ID` INT NOT NULL,
  `PRODUCT_ID` INT NOT NULL,
  `SUPPLIER_ID` INT NOT NULL,
  `PRODUCT_DETAILS_PRICE` INT NOT NULL,
  PRIMARY KEY (`PRODUCT_DETAILS_ID`),
  FOREIGN KEY (`PRODUCT_ID`) REFERENCES PRODUCT (`PRODUCT_ID`),
  FOREIGN KEY (`SUPPLIER_ID`) REFERENCES SUPPLIER(`SUPPLIER_ID`)  
  );

 
 
 
CREATE TABLE IF NOT EXISTS `ORDERS` (
  `ORDER_ID` INT NOT NULL,
  `ORDER_AMOUNT` INT NOT NULL,
  `ORDER_DATE` DATE,
  `CUSTOMER_ID` INT NOT NULL,
  `PRODUCT_DETAILS_ID` INT NOT NULL,
  PRIMARY KEY (`ORDER_ID`),
  FOREIGN KEY (`CUSTOMER_ID`) REFERENCES CUSTOMER(`CUSTOMER_ID`),
  FOREIGN KEY (`PRODUCT_DETAILS_ID`) REFERENCES PRODUCT_DETAILS(`PRODUCT_DETAILS_ID`)
  );

 
 
CREATE TABLE IF NOT EXISTS `RATINGS` (
  `RATING_ID` INT NOT NULL,
  `CUSTOMER_ID` INT NOT NULL,
  `SUPPLIER_ID` INT NOT NULL,
  `RATING_STARS` INT NOT NULL,
  PRIMARY KEY (`RATING_ID`),
  FOREIGN KEY (`SUPPLIER_ID`) REFERENCES SUPPLIER (`SUPPLIER_ID`),
  FOREIGN KEY (`CUSTOMER_ID`) REFERENCES CUSTOMER(`CUSTOMER_ID`)
  );

 
 
 
 ### INSERT-OPERATION ##################
 
SET FOREIGN_KEY_CHECKS=0; 



# INSERT SUPPLIER
INSERT
	INTO
	`SUPPLIER`
VALUES 
(1,"Rajesh Retails","Delhi",'1234567890'),
(2,"Appario Ltd.","Mumbai",'2589631470'),
(3,"Knome products","Banglore",'9785462315'),
(4,"Bansal Retails","Kochi",'8975463285'),
(5,"Mittal Ltd.","Lucknow",'7898456532') ;




# INSERT CUSTOMER
INSERT
	INTO
	`CUSTOMER`
VALUES 
(1,"AAKASH",'9999999999',"DELHI",'M'),
(2,"AMAN",'9785463215',"NOIDA",'M'),
(3,"NEHA",'9999999999',"MUMBAI",'F'),
(4,"MEGHA",'9994562399',"KOLKATA",'F'),
(5,"PULKIT",'7895999999',"LUCKNOW",'M');




# INSERT CATEGORY
INSERT
	INTO
	`CATEGORY`
VALUES
(1,"BOOKS"),
(2,"GAMES"),
(3,"GROCERIES"),
(4,"ELECTRONICS"),
(5,"CLOTHES");



# INSERT PRODUCT
INSERT
	INTO
	`PRODUCT`
VALUES
(1,"GTA V","DFJDJFDJFDJFDJFJF",2),
(2,"TSHIRT","DFDFJDFJDKFD",5),
(3,"ROG LAPTOP","DFNTTNTNTERND",4),
(4,"OATS","REURENTBTOTH",3),
(5,"HARRY POTTER","NBEMCTHTJTH",1);
  



# INSERT PRODUCT_DETAILS
INSERT
	INTO
	PRODUCT_DETAILS
VALUES
(1,1,2,1500),
(2,3,5,30000),
(3,5,1,3000),
(4,2,3,2500),
(5,4,1,1000);
  


# INSERT ORDERS
INSERT
	INTO
	`ORDERS`
VALUES
(50,2000,"2021-10-06",2,1),
(20,1500,"2021-10-12",3,5),
(25,30500,"2021-09-16",5,2),
(26,2000,"2021-10-05",1,1),
(30,3500,"2021-08-16",4,3);



#INSERT RATINGS
INSERT
	INTO
	`RATINGS`
VALUES
(1,2,2,4),
(2,3,4,3),
(3,5,1,5),
(4,1,3,2),
(5,4,5,4);


SET FOREIGN_KEY_CHECKS=1; 


#=====================Questions and Solutions====================
-- 3) Display the number of the customer group by their genders who have placed any order
-- of amount greater than or equal to Rs.3000.
SELECT
	COUNT(CUSTOMER_ID),
	CUSTOMER_GENDER
FROM
	ORDER_DIR.CUSTOMER
GROUP BY
	CUSTOMER_GENDER ;

-- OUTPUT
-- 3	M
-- 2	F



-- 4) Display all the orders along with the product name ordered by a customer having
-- Customer_Id=2.

SELECT
	O.CUSTOMER_ID ,
	O.ORDER_ID ,
	PD.PRODUCT_DETAILS_ID ,
	P.PRODUCT_ID ,
	P.PRODUCT_NAME
FROM
	ORDER_DIR.ORDERS O
JOIN ORDER_DIR.PRODUCT_DETAILS PD ON
	O.PRODUCT_DETAILS_ID = PD.PRODUCT_DETAILS_ID
JOIN ORDER_DIR.PRODUCT P ON
	PD.PRODUCT_ID = P.PRODUCT_ID
WHERE
	O.CUSTOMER_ID = 2;

-- OUTPUT
-- 2	50	1	1	GTA V





-- 5) Display the Supplier details who can supply more than one product.

SELECT
	*
FROM
	ORDER_DIR.SUPPLIER S
WHERE
	S.SUPPLIER_ID IN (
	SELECT
		PD.SUPPLIER_ID
	FROM
		ORDER_DIR.PRODUCT_DETAILS PD
	GROUP BY
		PD.SUPPLIER_ID
	HAVING
		COUNT(PD.PRODUCT_ID) > 1);

-- OUTPUT
-- 1	Rajesh Retails	Delhi	1234567890
	
	
	
	

-- 6) Find the category of the product whose order amount is minimum.
-- JOIN ORDER -> PRODUCT_DETAIILS -> PRODUCT -> CATEGORY
SELECT
	O.PRODUCT_DETAILS_ID,
	P.PRODUCT_ID ,
	P.PRODUCT_NAME,
	C.CATEGORY_NAME,
	SUM(O.ORDER_AMOUNT)
FROM
	ORDER_DIR.ORDERS O
JOIN ORDER_DIR.PRODUCT_DETAILS PD ON
	O.PRODUCT_DETAILS_ID = PD.PRODUCT_DETAILS_ID
JOIN ORDER_DIR.PRODUCT P ON
	PD.PRODUCT_ID = P.PRODUCT_ID
JOIN ORDER_DIR.CATEGORY C ON
	P.CATEGORY_ID = C.CATEGORY_ID
GROUP BY
	O.PRODUCT_DETAILS_ID
ORDER BY
	SUM(O.ORDER_AMOUNT)
LIMIT 1;

-- OUTPUT
-- 5	4	OATS	GROCERIES	1500
	
	



-- 7) Display the Id and Name of the Product ordered after “2021-10-05”.
-- ORDER AFTER DATE -> PRODUCT_DETAILS -> PRODUCT ID AND NAME

SELECT
	O.ORDER_ID ,
	O.ORDER_DATE,
	PD.PRODUCT_ID ,
	P.PRODUCT_NAME
FROM
	ORDER_DIR.ORDERS O
JOIN ORDER_DIR.PRODUCT_DETAILS PD ON
	O.PRODUCT_DETAILS_ID = PD.PRODUCT_DETAILS_ID
JOIN ORDER_DIR.PRODUCT P ON
	PD.PRODUCT_ID = P.PRODUCT_ID
WHERE
	O.ORDER_DATE > '2021-10-05';


-- OUTPUT
-- 20	2021-10-12	4	OATS
-- 50	2021-10-06	1	GTA V




-- 8) Print the top 3 supplier name and id and their rating on the basis of their rating along
-- with the customer name who has given the rating.
-- RATING TABLE -> SUPPLIER -> CUSTOMER TABLE JOINS AND TOP 3
SELECT
	R.RATING_ID ,
	S.SUPPLIER_NAME ,
	C.CUSTOMER_NAME ,
	R.RATING_STARS
FROM
	ORDER_DIR.RATINGS R
JOIN ORDER_DIR.SUPPLIER S ON
	R.SUPPLIER_ID = S.SUPPLIER_ID
JOIN ORDER_DIR.CUSTOMER C ON
	R.CUSTOMER_ID = C.CUSTOMER_ID
ORDER BY
	R.RATING_STARS DESC
LIMIT 3;


-- OUTPUT
-- 3	Rajesh Retails	PULKIT	5
-- 1	Appario Ltd.	AMAN	4
-- 5	Mittal Ltd.		MEGHA	4


-- 9) Display customer name and gender whose names start or end with character 'A'.
SELECT
	C.CUSTOMER_NAME ,
	C.CUSTOMER_GENDER
FROM
	ORDER_DIR.CUSTOMER C
WHERE
	C.CUSTOMER_NAME LIKE 'A%'
	OR C.CUSTOMER_NAME LIKE '%A';

/*
OUTPUT

AAKASH	M
AMAN	M
NEHA	F
MEGHA	F

*/



-- 10) Display the total order amount of the male customers.
-- ORDER -> CUSTOMER
SELECT
	SUM(O.ORDER_AMOUNT) ,
	C.CUSTOMER_GENDER
FROM
	ORDER_DIR.ORDERS O
JOIN ORDER_DIR.CUSTOMER C ON
	O.CUSTOMER_ID = C.CUSTOMER_ID
WHERE
	C.CUSTOMER_GENDER = 'M'
GROUP BY
	C.CUSTOMER_GENDER;

/*
OUTPUT

34500	M
*/





-- 11) Display all the Customers left outer join with the orders.
-- CUSTOMER -> ORDER
SELECT
	C.CUSTOMER_ID ,
	C.CUSTOMER_NAME ,
	O.ORDER_ID
FROM
	ORDER_DIR.CUSTOMER C
LEFT OUTER JOIN ORDER_DIR.ORDERS O ON
	C.CUSTOMER_ID = O.CUSTOMER_ID ;

/*

OUTPUT

1	AAKASH	26
2	AMAN	50
3	NEHA	20
4	MEGHA	30
5	PULKIT	25

*/



-- 12) Create a stored procedure to display the Rating for a Supplier if any along with the
-- Verdict on that rating if any like if rating >4 then “Genuine Supplier” if rating >2 “Average
-- Supplier” else “Supplier should not be considered”.


-- ANSWER FOR STORED PROC IN SEPARATE FILE AND BELOW AS WELL  
-- UNCOMMENT IT
/*
CREATE PROCEDURE ORDERS.RATING_PROC()
BEGIN
	SELECT
	S.SUPPLIER_ID,
	S.SUPPLIER_NAME,
	R.RATING_STARS,
	CASE 
		WHEN R.RATING_STARS > 4 THEN 'Genuine Supplier'
		WHEN R.RATING_STARS > 2 THEN 'Average Supplier'
		ELSE 'Supplier should not be considered'
	END AS VERDICT
FROM
	ORDERS.RATINGS R
INNER JOIN ORDERS.SUPPLIER S ON
	R.SUPPLIER_ID = S.SUPPLIER_ID;
END
*/ -- UNCOMMENT 

/*
OUTPUT

2	Appario Ltd.	4	Average Supplier
4	Bansal Retails	3	Average Supplier
1	Rajesh Retails	5	Genuine Supplier
3	Knome products	2	Supplier should not be considered
5	Mittal Ltd.		4	Average Supplier
*/




